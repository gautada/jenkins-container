#!/bin/sh

export IMAGE_NAME="$1"
export IMAGE_TAG="$2"
export REPOSITORY_NAME="$3"
# export VERSION_SCRIPT="$4"
# export CONTAINER_NAME="$(date +'%y%m%d-%H%M%S')-$IMAGE_NAME"

# ./build $IMAGE_NAME "--benchmark" &&
export CONTAINER_VERSION=$(./version $IMAGE_NAME $IMAGE_TAG) &&
docker tag $IMAGE_NAME:$IMAGE_TAG $REPOSITORY_NAME/$IMAGE_NAME:$CONTAINER_VERSION && 
docker tag $IMAGE_NAME:$IMAGE_TAG $REPOSITORY_NAME/$IMAGE_NAME:latest &&
docker push $REPOSITORY_NAME/$IMAGE_NAME:$CONTAINER_VERSION &&
docker push $REPOSITORY_NAME/$IMAGE_NAME:latest &&

docker rmi $IMAGE_NAME:$IMAGE_TAG $REPOSITORY_NAME/$IMAGE_NAME:latest $REPOSITORY_NAME/$IMAGE_NAME:$CONTAINER_VERSION 
